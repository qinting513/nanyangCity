(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-base_apply-material_page"],{"0e29":function(e,t,a){var i=a("24fb");t=i(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.bottom-btns[data-v-4a50a79a]{position:fixed;z-index:9999;bottom:0;left:0;right:0;height:%?100?%;width:100vw;text-align:center;line-height:%?100?%}.bottom-btns .pre[data-v-4a50a79a]{-webkit-box-flex:1;-webkit-flex:1;flex:1;color:#0072ff;background-color:#fff;position:relative}.bottom-btns .pre[data-v-4a50a79a]:after{content:"";position:absolute;top:%?24?%;right:0;bottom:%?24?%;width:1px;margin:auto 0;background-color:#ddd;overflow:hidden}.bottom-btns .tempstore[data-v-4a50a79a]{-webkit-box-flex:1;-webkit-flex:1;flex:1;color:#0072ff;background-color:#fff}.bottom-btns .next[data-v-4a50a79a]{-webkit-box-flex:1;-webkit-flex:1;flex:1;background-color:#0072ff;color:#fff}.tip[data-v-4a50a79a]{padding:%?20?% %?30?%;color:#ff5200;background-color:#fdf9ee;font-size:%?24?%}.materials[data-v-4a50a79a]{background-color:#fff;overflow-y:scroll}.materials .cell[data-v-4a50a79a]{border-bottom:%?1?% solid #f0f0f0;-webkit-box-align:start;-webkit-align-items:flex-start;align-items:flex-start;padding:%?20?% %?30?% %?30?% %?30?%}.materials .cell .top[data-v-4a50a79a]{-webkit-box-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-box-align:start;-webkit-align-items:flex-start;align-items:flex-start;font-size:%?30?%;color:#333}.materials .cell .top .star[data-v-4a50a79a]{font-size:%?36?%;color:red;margin-top:%?6?%}.materials .cell .top .paper[data-v-4a50a79a]{margin:0 %?8?%;color:#fff;font-size:%?24?%;padding:%?4?% %?8?%;background-color:#50ba47;border-radius:%?8?%}.materials .cell .center[data-v-4a50a79a]{padding:%?20?% 0;-webkit-box-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-flex-wrap:wrap;flex-wrap:wrap}.materials .cell .center .upload-img[data-v-4a50a79a]{width:%?106?%;height:%?106?%;background-color:#f8f8f8;border-radius:%?10?%;margin-right:%?10?%;margin-top:%?10?%;display:inline-block;-webkit-flex-shrink:0;flex-shrink:0}.materials .cell .center .upload-img uni-image[data-v-4a50a79a]{width:100%;height:100%}.materials .cell .center .add-btn[data-v-4a50a79a]{background-color:#f8f8f8;color:#ccc;width:%?106?%;height:%?106?%;border-radius:%?10?%;font-size:%?38?%}.materials .cell .bottom[data-v-4a50a79a]{font-size:%?25?%;color:#777}.materials .cell .bottom .have-data[data-v-4a50a79a]{color:#50ba47}',""]),e.exports=t},"452a":function(e,t,a){"use strict";a.r(t);var i=a("87f9"),n=a.n(i);for(var l in i)"default"!==l&&function(e){a.d(t,e,(function(){return i[e]}))}(l);t["default"]=n.a},"74be":function(e,t,a){"use strict";var i;a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return l})),a.d(t,"a",(function(){return i}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"material-page"},[a("v-uni-view",{staticClass:"tip"},[e._v(e._s(e.tipString))]),a("v-uni-view",{staticClass:"materials",style:[e.materialStyle]},e._l(e.materialList,(function(t,i){return a("v-uni-view",{key:i,staticClass:"flex-column cell"},[a("v-uni-view",{staticClass:"flex-row top"},["1"==t.SFBY?a("v-uni-view",{staticClass:"star"},[e._v("*")]):e._e(),a("v-uni-view",{staticClass:"paper"},[e._v("纸")]),a("v-uni-view",{staticClass:"title"},[e._v(e._s(t.CLMC))])],1),a("v-uni-view",{staticClass:"flex-row center"},[e._l(e.materials?e.materials[t.ID]:[],(function(e,t){return a("v-uni-view",{key:t,staticClass:"upload-img"},[a("v-uni-image",{attrs:{src:e.filepath||e.localImg,mode:"scaleToFill"}})],1)})),a("v-uni-view",{staticClass:"flex-column add-btn",on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.addImages(t)}}},[a("v-uni-view",{staticClass:"add"},[e._v("+")])],1)],2),a("v-uni-view",{staticClass:"bottom"},[null!=e.materialsNumber[t.ID]?a("v-uni-view",{staticClass:"have-data"},[e._v("已上传("+e._s(e.materialsNumber[t.ID]["uploading"]||0)+"/"+e._s(e.materialsNumber[t.ID]["uploaded"]||0)+")")]):a("v-uni-view",{staticClass:"nodata"},[e._v("暂无上传")])],1)],1)})),1),a("v-uni-view",{staticClass:"flex-row bottom-btns"},[a("v-uni-view",{staticClass:"pre",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.pre.apply(void 0,arguments)}}},[e._v("上一步")]),a("v-uni-view",{staticClass:"tempstore",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.tempStore.apply(void 0,arguments)}}},[e._v("暂存")]),a("v-uni-view",{staticClass:"next",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.next.apply(void 0,arguments)}}},[e._v("下一步")])],1)],1)},l=[]},"87f9":function(e,t,a){"use strict";var i=a("4ea4");a("99af"),a("4160"),a("c975"),a("baa5"),a("a9e3"),a("d3b7"),a("25f0"),a("159b"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("33b4")),l=(i(a("95c1")),i(a("cbf0")),a("2f62")),o={name:"MaterialPage",props:{pageHeight:{type:Number}},data:function(){return{tipString:"温馨提示：如果材料是暂未上传的标识需要点击上传附件；如果材料出现上传失败的标识，请点击重新上传，直到出现材料上传成功的绿色标识，既表示该材料已成功电子化上传。",materialsNumber:{},materials:null,uploadInfo:{},materialStyle:{}}},computed:(0,l.mapState)(["applyItemInfo","userInfo","businessModel","formsModel","materialsModel","postModel","materialList"]),created:function(){},mounted:function(){this.pageHeight>0?(this.materialStyle={height:this.pageHeight-180+"px"},console.log("materialStyle:",this.materialStyle)):(this.materialStyle={height:"600px"},console.log("other materialStyle:",this.materialStyle))},methods:{updateMaterials:function(e,t){this.materials=e,this.materialsNumber=t},addImages:function(e){var t=this.materials||{},a=t[e.ID];if(null!=a&&a.length>=9)uni.showToast({icon:"none",title:"最多只能上传9份文件"});else{var i=this;uni.showActionSheet({itemList:["拍照","相册获取"],success:function(t){var a=t.tapIndex;console.log("index:",a),i.chooseImages(a,e)},fail:function(e){console.log(e.errMsg)}})}},chooseImages:function(e,t){var a=this,i=this.materials||{},n=(i[t.ID]||[]).length;uni.chooseImage({count:9-n,sizeType:["original","compressed"],sourceType:1==e?["album"]:["camera"],success:function(e){if(e.tempFilePaths.length>0){var i=a.materials||{},n=(i[t.ID]||[]).length;a.updateMaterialNumber({itemId:t.ID,uploaded:n+e.tempFilePaths.length}),a.uploadAllImgs({model:t,localImgPaths:e.tempFilePaths,localTemp:e.tempFiles})}}})},uploadAllImgs:function(e){var t=this,a=e.i?e.i:0,i=e.success?e.success:0,n=e.fail?e.fail:0,l="上传中(".concat(a+1,"/").concat(e.localImgPaths.length,")");uni.showLoading({title:l,mask:!0}),t.upload2wx(e.localImgPaths[a],e.localTemp[a].name,e.model,(function(e){i++,console.log("successBlock",e),console.log(a)}),(function(i){n++,console.log("failBlock fail index:",a),console.log("failBlock fail err:",i),uni.showToast({icon:"none",title:"第".concat(a+1,"张上传失败")});var l=t.materials||{},o=l[e.model.ID]||[];o.pop(),t.$set(t.materials,e.model.ID,o);var s=(t.materialsNumber[e.model.ID]||{}).uploaded||0;s-=1,t.updateMaterialNumber({itemId:e.model.ID,uploaded:s})}),(function(){if(console.log("completeBlock:",a),a++,a==e.localImgPaths.length){uni.hideLoading(),console.log("执行完毕"),console.log("成功："+i+" 失败："+n);var l={success:i,fail:n};t.$set(t.uploadInfo,e.model.ID,l),t.$store.commit("updateUploadMaterials",t.materials),t.$store.commit("updateUploadMaterialsNum",t.materialsNumber)}else console.log(a),e.i=a,e.success=i,e.fail=n,t.uploadAllImgs(e)}))},upload2wx:function(e,t,a,i,l,o){var s={id:"",fileid:e,filepath:"",filedel:"",filename:"",filetype:"img",isUploading:1,localImg:e},r=this.materials||{},u=r[a.ID]||[];u.push(s),r[a.ID]=u,this.materials=r;var d=e.lastIndexOf("."),c=e.substr(d);if(t)d=t.lastIndexOf("."),c=t.substr(d);var m="材料";if(null!=a.CLMC){var f=n.default.materialNameList;f.forEach((function(e){-1!=a.CLMC.indexOf(e)&&(m=e)}))}for(var p=u.length,h=m+"_"+p+c,g=0;g<u.length;g++){var v=u[g];if(v["filename"]==h){p++,h=m+"_"+p.toString()+c;break}}var b=this;uni.uploadFile({url:n.default.uploadFileURL,filePath:e,name:"file",formData:{USERID:this.userInfo.USER_ID,SXID:this.businessModel.permId,FILENAME:h},success:function(t){var l=JSON.parse(t.data);if(console.log("上传返回数据:",l),200==l.code){var o=l.ReturnValue.FILEID,s=n.default.downloadFileURL+o;console.log("===>after upload responseFileID:",o);for(var r=b.materials||{},u=r[a.ID]||[],d=-1,c=0;c<u.length;c++){var m=u[c];if(m["fileid"]===e){d=c;break}}d>-1&&(u[d]={id:o,fileid:o,filepath:s,filedel:"",filename:h,filetype:"img",isUploading:0,localImg:e}),r[a.ID]=u,b.materials=r,console.log("===>after upload materials:",b.materials);var f=(b.materialsNumber[a.ID]||{}).uploading||0;f+=1,b.updateMaterialNumber({itemId:a.ID,uploading:f}),i(l)}},fail:function(e){l(e)},complete:function(e){o()}})},updateMaterialNumber:function(e){var t=this.materialsNumber||{},a=t[e.itemId]||{};null!=e.uploading&&(a.uploading=e.uploading),null!=e.uploaded&&(a.uploaded=e.uploaded),this.$set(this.materialsNumber,e.itemId,a),this.$forceUpdate()},pre:function(){this.$emit("pre",{page:"MaterialPage"})},tempStore:function(){this.$emit("tempStore",{page:"MaterialPage"})},next:function(){this.$emit("next",{page:"MaterialPage"})},checkMaterial:function(e){if(null!=this.materialList&&0==this.materialList.length)return this.formsModel.stateMaterial=!0,this.$store.commit("updateFormsModel",this.formsModel),!0;var t=!0;for(var a in this.materialList){var i=this.materialList[a];"1"!=i.SFBY||null!=this.materialsNumber[i.ID]&&null!=this.materialsNumber[i.ID]["uploaded"]&&0!=this.materialsNumber[i.ID]["uploaded"]||(t=!1)}return!t&&e&&uni.showToast({icon:"none",title:"带*号的都为必须提交的材料"}),t&&(this.formsModel.stateMaterial=!0,this.$store.commit("updateFormsModel",this.formsModel)),t}}};t.default=o},"95c1":function(e,t,a){"use strict";var i=a("4ea4");a("d3b7");var n=i(a("b8bb")),l=i(a("33b4")),o=i(a("cbf0"));function s(e){return new Promise((function(t,a){var i={PERMID:e};console.log("获取材料列表"),n.default.soup(l.default.url_base_apply_get_materail,l.default.method_base_apply_get_materail,i).then((function(e){t(e)})).catch((function(e){a(e)}))}))}function r(e){return new Promise((function(t,a){var i={PERMID:e,ENTERANCE:"1"};n.default.soup(l.default.url_base_apply_get_materail,l.default.method_base_apply_get_getFormByPermidV2,i).then((function(e){t(e)})).catch((function(e){a(e)}))}))}function u(e,t){return new Promise((function(a,i){var o={token:e,BSNUM:t};n.default.soup(l.default.url_submit_apply,l.default.method_base_apply_getwebhallbusiness,o).then((function(e){a(e)})).catch((function(e){i(e)}))}))}function d(e,t){return new Promise((function(a,i){var s={token:e,BSNUM:t};n.default.soup(l.default.url_submit_apply,l.default.method_base_apply_getInsFormData,s).then((function(e){if(200==e["code"]&&null!=e["ReturnValue"]){var t=e["ReturnValue"],i=t["FORMS"],n=o.default.base64Decode(i);a(o.default.formDealWithData(n))}})).catch((function(e){i(e)}))}))}function c(e,t){return new Promise((function(a,i){var s={token:e,BSNUM:t};n.default.soup(l.default.url_submit_apply,l.default.method_base_apply_getInsMaterialInfo,s).then((function(e){if(200==e["code"]&&null!=e["ReturnValue"]){var t=e["ReturnValue"],i=t["MATERIALS"],n=o.default.base64Decode(i);a(o.default.materialDealWithData(n))}})).catch((function(e){i(e)}))}))}function m(e){return new Promise((function(t,a){var i={PERMID:e};n.default.soup(l.default.url_permname_list,l.default.mothod_getPermWsfwsd,i).then((function(e){t(e)})).catch((function(e){a(e)}))}))}function f(e){return new Promise((function(t,a){var i={PERMID:e};n.default.soup(l.default.url_organization,l.default.mothod_getNetworkByPermid,i).then((function(e){t(e)})).catch((function(e){a(e)}))}))}function p(e,t){return new Promise((function(a,i){var o={PERMID:e};null!=t&&(o["BSNUM"]=t),n.default.soup(l.default.url_department,l.default.mothod_getRegionByPermidBsnum,o).then((function(e){a(e)})).catch((function(e){i(e)}))}))}function h(e){return new Promise((function(t,a){var i={PAGESIZE:"20",PAGENO:"1",USERID:e};n.default.soup(l.default.url_reset_address_service_query,l.default.mothod_getUserPostInfo,i).then((function(e){t(e)})).catch((function(e){a(e)}))}))}function g(e){return new Promise((function(t,a){console.log("申报参数:",e),n.default.soup(l.default.url_submit_apply,l.default.method_submit_apply,e).then((function(e){t(e)})).catch((function(e){a(e)}))}))}function v(e,t,a){var i='<?xml version="1.0" encoding="UTF-8"?><business><businessid><![CDATA['+(t.bsnum||"")+"]]></businessid><cbusinessid><![CDATA["+(t.bsnum||"")+"]]></cbusinessid><citemid><![CDATA["+(t.citemid||"")+"]]></citemid><citemversion><![CDATA["+(t.citemversion||"")+"]]></citemversion><permid><![CDATA["+(t.permId||"")+"]]></permid><largeitemid><![CDATA["+(t.largeitemid||"")+"]]></largeitemid><smallitemid><![CDATA["+(t.smallitemid||"")+"]]></smallitemid><smallitemname><![CDATA["+(t.smallitemname||"")+"]]></smallitemname><itemversion><![CDATA["+(t.itemversion||"")+"]]></itemversion><itemlimittime><![CDATA["+(t.itemlimittime||"")+"]]></itemlimittime><itemlimitunit><![CDATA["+(t.itemlimitunit||"")+"]]></itemlimitunit><regionid><![CDATA["+(t.regionid||"")+"]]></regionid><deptcode><![CDATA["+(t.deptcode||"")+"]]></deptcode><deptname><![CDATA["+(t.deptname||"")+"]]></deptname><projectname><![CDATA["+(t.projectname||"")+"]]></projectname><receiptid><![CDATA["+(t.bsnum||"")+"]]></receiptid><submittype><![CDATA[5]]></submittype><lawaddr><![CDATA["+(t.lawaddr||"")+"]]></lawaddr><realaddr><![CDATA["+(t.realaddr||"")+"]]></realaddr><status><![CDATA["+String(e)+"]]></status><applicantid><![CDATA["+(a.USER_ID||"")+"]]></applicantid><state>5</state><sqr_type><![CDATA["+(a.TYPE||"")+"]]></sqr_type></business>";return console.log("business 数据:",i),o.default.base64Encode(o.default.utf16to8(i))}function b(e){return null==e?"":o.default.base64Encode(o.default.utf16to8(e))}function A(e){var t='<?xml version="1.0" encoding="UTF-8"?><forms><data><dataid>'+(e.dataid||"")+"</dataid><formtype>"+(e.formtype||"")+"</formtype><pid>"+(e.pid||"")+"</pid><bsnum>"+(e.bsnum||"")+"</bsnum><formid>"+(e.formid||"")+'</formid><version></version><sqr_mc type="TEXTINPUT"><![CDATA['+(e.sqrmc||"")+']]></sqr_mc><sqr_yddh type="TEXTINPUT"><![CDATA['+(e.sqryddh||"")+']]></sqr_yddh><sqr_sfzjhm type="TEXTINPUT"><![CDATA['+(e.sqrsfzjhm||"")+']]></sqr_sfzjhm><sqr_dzxx type="TEXTINPUT"><![CDATA['+(e.sqrdzxx||"")+']]></sqr_dzxx><sqr_gddh type="TEXTINPUT"><![CDATA['+(e.sqrgddh||"")+']]></sqr_gddh><sqr_gddz type="TEXTINPUT"><![CDATA['+(e.sqrgddz||"")+']]></sqr_gddz><sqxmmc type="TEXTINPUT"><![CDATA['+(e.sqxmmc||"")+']]></sqxmmc><zjlx type="COMBOBOX"><![CDATA['+(e.zjlx||"")+']]></zjlx><bz type="TEXTINPUT"><![CDATA['+(e.bz||"")+"]]></bz></data></forms>";return console.log("form 数据:",t),o.default.base64Encode(o.default.utf16to8(t))}function D(e,t,a){for(var i='<?xml version="1.0" encoding="UTF-8"?><materials>',n=0;n<e.length;n++){var l=e[n];if(i+="<materialinfo><id><![CDATA[]]></id><materialid><![CDATA["+(l.ID||"")+"]]></materialid><materialname><![CDATA["+(l.CLMC||"")+"]]></materialname><materialcode><![CDATA["+(l.ID||"")+"]]></materialcode><submittype><![CDATA["+(l.DZHYQ||"")+"]]></submittype><orinum><![CDATA[]]></orinum><copynum><![CDATA[]]></copynum><isneed><![CDATA["+(l.SFBY||"")+"]]></isneed><status><![CDATA["+(l.STATUS||"")+"]]></status><formid><![CDATA[]]></formid><formver><![CDATA[]]></formver><dataid><![CDATA[]]></dataid><remark><![CDATA[]]></remark><username><![CDATA["+(a.realName||"")+"]]></username>",null!=t){var s=t[l.ID];if(null!=s&&s.length>0)for(var r in s){var u=s[r];i+="<file>",i+="<fileid><![CDATA["+u["fileid"]+"]]></fileid><filename><![CDATA["+u["filename"]+"]]></filename><filepath><![CDATA["+u["filepath"]+"]]></filepath><filedel><![CDATA["+u["filedel"]+"]]></filedel>",i+="</file>"}}i+="</materialinfo>"}return i+="</materials>",console.log("material 数据:",i),o.default.base64Encode(o.default.utf16to8(i))}e.exports={getMaterialList:s,getFormByPermidV2:r,getWebhallbusiness:u,getInsFormData:d,getInsMaterialInfo:c,getPermWsfwsd:m,getRegionByPermidBsnum:p,getNetworkByPermid:f,getUserPostInfo:h,getPostXmlData:b,tempStore:g,getBusinessXml:v,getFormXml:A,getMaterialXml:D}},a7a4:function(e,t,a){"use strict";var i=a("b3f0"),n=a.n(i);n.a},b3f0:function(e,t,a){var i=a("0e29");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("4f06").default;n("65219210",i,!0,{sourceMap:!1,shadowMode:!1})},b8bb:function(e,t,a){"use strict";var i=a("4ea4");a("c975"),a("d3b7");var n=i(a("cbf0")),l=i(a("43a3")),o='<?xml version="1.0" encoding="utf-8"?>',s='<soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">',r="<soap:Body>",u="</soap:Body>",d="</soap:Envelope>";function c(e,t,a,i){return uni.showLoading({title:"数据加载中..."}),new Promise((function(l,c){null!=i&&""!=i||(i="POST");var p="<"+t+' xmlns:n0="http://service.rest2.cms.jeecms.com/"><param>'+JSON.stringify(a)+"</param></"+t+">",h=o+s+r+p+u+d;uni.request({url:e,data:h,method:i,header:{"content-type":"text/xml; charset=utf-8",SOAPAction:t},success:function(t){if(200===t.statusCode){var a=m(t.data),i=JSON.parse(a);n.default.checkResponse(i),l(i)}else console.log("请求参数:",e,h),f("错误码："+t.statusCode+"\n\t  错误信息："+t.data);uni.hideLoading()},fail:function(e){uni.hideLoading(),c(e)}})}))}function m(e){for(var t=new l.default.DOMParser,a=t.parseFromString(e,"text/xml"),i=a.getElementsByTagName("soap:Body")[0],n=i.childNodes,o=i.childNodes.length,s=0;s<o;s++)if(n[s].nodeName.indexOf("Response")>=0)for(var r=n[s].childNodes,u=0;u<r.length;u++)if(r[u].nodeName.indexOf("return")>=0)return r[u].childNodes[0].nodeValue;return""}function f(e){console.log("--------------------------我是错误分割线--------------------------"),uni.showModal({title:"提示",content:"服务请求异常"}),console.log("服务请求异常:",e),console.log("--------------------------我是错误分割线--------------------------")}e.exports={soup:c}},c10d:function(e,t,a){"use strict";a.r(t);var i=a("74be"),n=a("452a");for(var l in n)"default"!==l&&function(e){a.d(t,e,(function(){return n[e]}))}(l);a("a7a4");var o,s=a("f0c5"),r=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"4a50a79a",null,!1,i["a"],o);t["default"]=r.exports}}]);